local Players = game:GetService("Players")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local userInputService = game:GetService("UserInputService")
local camera = workspace.CurrentCamera

local defaultWalkspeed = humanoid.WalkSpeed
local defaultJumpPower = humanoid.JumpPower
local flying = false
local noclip = false
local espEnabled = false
local speedHackEnabled = false
local jumpPowerEnabled = false
local darkTheme = true
local MAX_WALK_SPEED = 150
local MAX_JUMP_POWER = 200

local MAX_FLY_SPEED = 1000
local flyLoop

-- ESP Sistem
local ESP = {
    Boxes = {},
    Names = {},
    TeamCheck = false
}

function ESP:Toggle(enable)
    if enable then
        self:Create()
    else
        self:Clear()
    end
end

function ESP:Create()
    self:Clear()

    for _, targetPlayer in ipairs(Players:GetPlayers()) do
        if targetPlayer ~= player and targetPlayer.Character then
            local char = targetPlayer.Character
            if char:FindFirstChild("HumanoidRootPart") then
                -- Kutu ESP
                local box = Instance.new("BoxHandleAdornment")
                box.Name = targetPlayer.Name .. "_ESPBox"
                box.Adornee = char.HumanoidRootPart
                box.AlwaysOnTop = true
                box.ZIndex = 5
                box.Size = Vector3.new(4, 6, 1)
                box.Transparency = 0.7
                box.Color3 = self.TeamCheck and targetPlayer.Team == player.Team
                    and Color3.new(0, 1, 0) or Color3.new(1, 0, 0)
                box.Parent = char.HumanoidRootPart
                self.Boxes[targetPlayer] = box

                -- İsim Etiketi
                local billboard = Instance.new("BillboardGui")
                billboard.Name = targetPlayer.Name .. "_ESPName"
                billboard.Adornee = char.Head
                billboard.Size = UDim2.new(0, 200, 0, 50)
                billboard.StudsOffset = Vector3.new(0, 2.5, 0)
                billboard.AlwaysOnTop = true

                local textLabel = Instance.new("TextLabel")
                textLabel.Text = targetPlayer.Name
                textLabel.Size = UDim2.new(1, 0, 1, 0)
                textLabel.BackgroundTransparency = 1
                textLabel.TextColor3 = box.Color3
                textLabel.TextStrokeTransparency = 0.5
                textLabel.Font = Enum.Font.GothamBold
                textLabel.TextSize = 14
                textLabel.Parent = billboard

                billboard.Parent = char.Head
                self.Names[targetPlayer] = billboard
            end
        end
    end
end

function ESP:Clear()
    for _, box in pairs(self.Boxes) do
        box:Destroy()
    end
    for _, name in pairs(self.Names) do
        name:Destroy()
    end
    self.Boxes = {}
    self.Names = {}
end

-- Fly Button İşlevi
flyButton.MouseButton1Click:Connect(function()
    flying = not flying
    if flying then
        humanoid.PlatformStand = true
        workspace.Gravity = 0
        flyButton.Text = "Un Fly"
        flyButton.BackgroundColor3 = Color3.fromRGB(50, 255, 50)

        flyLoop = RunService.RenderStepped:Connect(function()
            local pos = humanoidRootPart.Position
            local look = (camera.Focus.Position - camera.CFrame.Position).Unit
            local move = Vector3.zero

            if userInputService:IsKeyDown(Enum.KeyCode.W) then move += Vector3.new(0, 0, -1) end
            if userInputService:IsKeyDown(Enum.KeyCode.S) then move += Vector3.new(0, 0, 1) end
            if userInputService:IsKeyDown(Enum.KeyCode.A) then move += Vector3.new(-1, 0, 0) end
            if userInputService:IsKeyDown(Enum.KeyCode.D) then move += Vector3.new(1, 0, 0) end
            if userInputService:IsKeyDown(Enum.KeyCode.Space) then move += Vector3.new(0, 1, 0)
            elseif userInputService:IsKeyDown(Enum.KeyCode.LeftControl) then move += Vector3.new(0, -1, 0) end

            local speed = tonumber(flySpeedBox.Text) or 50
            humanoidRootPart.CFrame = CFrame.new(pos, pos + look) * CFrame.new(move * speed)
        end)
    else
        humanoid.PlatformStand = false
        workspace.Gravity = defaultGravity
        flyButton.Text = "Fly"
        flyButton.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
        if flyLoop then flyLoop:Disconnect() end
    end
end)

-- NoClip Fonksiyonu
noclipButton.MouseButton1Click:Connect(function()
    noclip = not noclip
    for _, part in ipairs(character:GetDescendants()) do
        if part:IsA("BasePart") then
            part.CanCollide = not noclip
        end
    end
    noclipButton.Text = noclip and "Clip" or "NoClip"
    noclipButton.BackgroundColor3 = noclip and Color3.fromRGB(50, 255, 50) or Color3.fromRGB(255, 50, 50)
end)

-- Speed Hack Fonksiyonu
speedButton.MouseButton1Click:Connect(function()
    speedHackEnabled = not speedHackEnabled
    if speedHackEnabled then
        local speed = math.clamp(tonumber(speedBox.Text) or defaultWalkspeed, 16, MAX_WALK_SPEED)
        humanoid.WalkSpeed = speed
        speedButton.Text = "Speed: ON"
        speedButton.BackgroundColor3 = Color3.fromRGB(50, 255, 50)
    else
        humanoid.WalkSpeed = defaultWalkspeed
        speedButton.Text = "Speed: OFF"
        speedButton.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
    end
end)

-- Jump Power Fonksiyonu
jumpPowerButton.MouseButton1Click:Connect(function()
    jumpPowerEnabled = not jumpPowerEnabled
    if jumpPowerEnabled then
        local power = math.clamp(tonumber(jumpPowerBox.Text) or defaultJumpPower, 0, MAX_JUMP_POWER)
        humanoid.JumpPower = power
        jumpPowerButton.Text = "JumpPower: ON"
        jumpPowerButton.BackgroundColor3 = Color3.fromRGB(50, 255, 50)
    else
        humanoid.JumpPower = defaultJumpPower
        jumpPowerButton.Text = "JumpPower: OFF"
        jumpPowerButton.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
    end
end)

-- Tema Fonksiyonu
themeButton.MouseButton1Click:Connect(function()
    darkTheme = not darkTheme
    local bgColor = darkTheme and Color3.fromRGB(35, 35, 35) or Color3.fromRGB(220, 220, 220)
    local panelColor = darkTheme and Color3.fromRGB(40, 40, 40) or Color3.fromRGB(180, 180, 180)
    local textColor = darkTheme and Color3.fromRGB(255, 255, 255) or Color3.fromRGB(0, 0, 0)

    -- Tema değişikliği
    mainFrame.BackgroundColor3 = bgColor
    settingsPanel.BackgroundColor3 = panelColor
    for _, child in ipairs(mainFrame:GetDescendants()) do
        if child:IsA("TextLabel") or child:IsA("TextButton") then
            child.TextColor3 = textColor
            if child:IsA("TextButton") and child ~= closeButton then
                child.BackgroundColor3 = darkTheme and Color3.fromRGB(100, 100, 100) or Color3.fromRGB(150, 150, 150)
            end
        end
    end
    themeButton.Text = "Tema: " .. (darkTheme and "Dark" or "Light")
end)

-- Config Sistemi
_G.volixConfig = _G.volixConfig or {}
configButton.MouseButton1Click:Connect(function()
    -- Config yükleme veya kaydetme işlemleri burada yapılabilir
end)
